\chapter{Intermediate Steps in Forming Inverse Kinematic Equations} \label{sec:InvKinEqSteps}

In a first step \ref{eq:ForwKinEquMatr} is reformed into \ref{eq:ForwKinEquMatr_reformed}.
\begin{equation}\label{eq:ForwKinEquMatr_reformed}
\phantom{}^2T_3\phantom{}^3T_4\phantom{}^4T_5 = \phantom{}^0T_6(\phantom{}^0T_1)^{-1}(\phantom{}^1T_2)^{-1}(\phantom{}^5T_6)^{-1}
\end{equation}
This gives 2 matrices, formed by the terms found in appendix \ref{eq:TransformMatrices_0-6}. These matrices are the terms found in \ref{eq:ForwKinEquMatr_reformed}.
With the help of MATLAB and the symbolic toolbox, the inverses and the overall product of each side can be calculated. %should be done for actual confirmation. Test it!

\input{ThesisWork/BackKinematics/Prelinkmultip}


As shown by \ref{eq:ForwKinEquMatr_reformed}, the elements of matrices \ref{eq:prelinkmultip_right} \ref{eq:prelinkmultip_left} are corresponding equal. This allows to find analytic expressions for all $\gls{theta_i}$.

\paragraph{$\pmb{\theta_1}$:}

By taking the elements (\textcolor{green}{3},\textcolor{red}{4}) of \ref{eq:prelinkmultip_right} \ref{eq:prelinkmultip_left} as corresponding equal, equation \ref{eq:equal_3-4} is formed.
\begin{equation}\label{eq:equal_3-4}
-(-s_1a_x + c_1 a_y )d_6 - s_1 p_x +c_1 p_y = 0
\end{equation}
Reforming equation \ref{eq:equal_3-4} gives a solution for $\theta_1$ as seen in equations \ref{eq:sol_theta_1_appendix}.
\begin{multline}\label{eq:sol_theta_1_appendix}
\theta_{1_1} = \atantwo ( p_y - a_y d_6 , p_x - a_x d_6) 
\phantom{..........}
\theta_{1_2} = \atantwo (-p_y + a_y d_6 ,-p_x + a_x d_6) 
\end{multline}
\medskip

\paragraph{$\pmb{\theta_2}$:}

Taking elements (\textcolor{green}{1},\textcolor{red}{4}) and (\textcolor{green}{2},\textcolor{red}{4}) of \ref{eq:prelinkmultip_right} \ref{eq:prelinkmultip_left} as corresponding equal,  \ref{eq:equal_1-4} and \ref{eq:equal_2-4} are formed.
\begin{equation}\label{eq:equal_1-4}
a_3 c_3 - d_4 s_3 + a_2 = - (c_2 c_1 a_x + c_2 s_1 a_y -s_2 a_z)d_6 + c_2 c_1 p_x + c_2 s_1 p_y -s_2 p_z -c_2 a_1
\end{equation}
\begin{equation}\label{eq:equal_2-4}
a_3 s_3 +d_4 c_3 = - (- s_2 c_1 a_x - s_2 s_1 a_y - c_2 a_z)d_6 s_2 c_1 p_x s_2 s_1 p_y  -c_2 p_z +s_2 a_1
\end{equation}
For simplification of the terms in equations \cref{eq:equal_1-4,eq:equal_2-4}, middle variables are chosen:
\begin{equation}
u=c_1 (p_x d_6 a_x ) + s_1 (p_y -a_y d_6)-a_1 \phantom[...]
v= p_z - a_z d_6
\end{equation}

With these middle variables equations \ref{eq:equal_1-4} and \ref{eq:equal_2-4} can be rewritten as seen in \ref{eq:equal_1-4_midVar} and \ref{eq:equal_2-4_midVar}.
\begin{equation}\label{eq:equal_1-4_midVar}
a_3 c_3 - d_4 s_3 = c_2 u -s_2 v -a_2 
\end{equation}
\begin{equation}\label{eq:equal_2-4_midVar}
a_3 s_3 + d_4 c_3 = - s_ u - c_2 v
\end{equation}
To eliminate $s_3$ and $c_3$ \ref{eq:equal_1-4_midVar} and \ref{eq:equal_2-4_midVar} are squared and then added to form \ref{eq:1-4+2_4}.
\begin{equation}\label{eq:1-4+2_4}
a_3^2 +d_4^2 = u^2 +v^2 - 2a_2 c_2 u + 2a_2 s_2 v +a_2^2
\end{equation}
\begin{equation}\label{eq:1-4+2_4_reformed}
\frac{a_3^2 + d_4^2 - u^2 - v^2 -a_2^2}{-2a_2}= c_2 u -s_2 v
\end{equation}
This equation can be further simplified by taking another middle variable:
\begin{equation*}
m = \frac{a_3^2 +d_4^2 - u^1 -v^2 - a_2^2}{-2a_2}
\end{equation*}
Reforming equation \ref{eq:1-4+2_4_reformed} and inserting the middle variable reveals a solution for $\theta_2$ as seen in \ref{eq:sol_theta_2_appendix}.
\begin{equation}\label{eq:sol_theta_2_appendix}
\theta_{2_{1/2}} = \atantwo (-v , u)\pm \atantwo(\sqrt{v^2 +u^2 - m^2 } , m)
\end{equation}



\paragraph{$\pmb{\theta_3}$:}

To receive $\theta_3$ it helps to take  \ref{eq:equal_1-4} and \ref{eq:equal_2-4}. Equation \ref{eq:equal_1-4} needs to be reformed into \ref{eq:eqal_1-4_reformed}.
\begin{equation} \label{eq:eqal_1-4_reformed}
a_c c_3 d_4 s_3 + a_2 = c_2 u -s_2 v
\end{equation}
Squaring of \ref{eq:eqal_1-4_reformed} and \ref{eq:equal_2-4} and adding them eliminates $s_2$ and $c_2$ as seen in \ref{eq:1-4_reformed+2_4}.
\begin{equation}\label{eq:1-4_reformed+2_4}
a_2^2 + a_3^2 +d_4^2 + 2 a_2(a_3 c_3 -d_4 s_3) = u^2 + v^2
\end{equation}
\begin{equation}\label{eq:1-4_reformed+2_4_reformed}
a_3 c_3 - d_4 s_3 = \frac{a_3^2 + d_4^2 - u^2 -v^2 +a_2^2}{2a_2}
\end{equation}

Again, this equation can be further simplified by taking another middle variable:
\begin{equation*}
-\frac{a_3^2 + d_4^2 - u^2 -v^2 + a_2^2}{2a_2}
\end{equation*}

Reforming equation \ref{eq:1-4_reformed+2_4_reformed} and inserting the middle variable reveals a solution for $\theta_3$ as seen in \cref{eq:sol_theta_3_appendix}.
\begin{equation}\label{eq:sol_theta_3_appendix}
\theta_{3_{1/2}} = \atantwo(-d_4 , a_3) \pm A \tan (2 (\sqrt{d_4^2 +a_3^2 -h^2} , h))
\end{equation}


\paragraph{$\pmb{\theta_5}$:}
Taking elements (\textcolor{green}{2},\textcolor{red}{2}) and (\textcolor{green}{1},\textcolor{red}{2}) of  \ref{eq:prelinkmultip_right} and \ref{eq:prelinkmultip_left} as corresponding equal,  \ref{eq:equal_2-2} and \ref{eq:equal_1-2} are formed.

\begin{equation}\label{eq:equal_2-2}
-s_3 c_4 s_5 + c_3 c_5 = -c_1 s_2 a_x - s_1 s_2 a_y -c_2 a_z
\end{equation}
\begin{equation}\label{eq:equal_1-2}
-c_3 c_4 s_5 - s_3 c_4 = c_1 c_2 a_x + s_1 c_2 a_y - s_2 a_z
\end{equation}

To combine equations \ref{eq:equal_2-2} and \ref{eq:equal_1-2}, \ref{eq:equal_2-2} is multiplied with $c_3$ and  \ref{eq:equal_1-2} is multiplied by $ s_2$. The resulting equations are then subtracted from each other giving \ref{eq:2-2+1-2}.
\begin{equation}\label{eq:2-2+1-2}
c_5 = (-c_1 s_2 a_x - s_1 s_2 a_y -c_2 a_z) c_3 - (c_1 c_2 a_x +s_1 c_2 a_y - s_2 a_z) s_3
\end{equation}
Reforming equation \ref{eq:2-2+1-2} gives a solution for $\theta_5$ as seen in equation \ref{eq:sol_theta_5_appendix}.
\begin{equation}\label{eq:sol_theta_5_appendix}
\theta_{5_{1/2}} = \pm \acos [ ( -c_1 s_2 a_x - s_1 s_2 a_y - c_2 a_z) c_3 - (c_1 c_2 a_x + s_1 c_2 a_y - s_2 a_z) s_3]
\end{equation}

\paragraph{$\pmb{\theta_4}$:}

With $\theta_5$ and $\theta_{1-3}$ known, equation \ref{eq:equal_1-2} can be reformed into a solution for $\theta_4$ as seen in equation \ref{eq:sol_theta_4_appendix}.
\begin{equation}\label{eq:sol_theta_4_appendix}
\theta_{4_{1/2}} = \pm \arccos [ \frac{ c_1 c_2 a_x + s_1 c_2 a_y - s_2 a_z + s_3 c_5}{-c_3 s_5}]
\end{equation}

\paragraph{$\pmb{\theta_6}$:}
By taking the elements (\textcolor{green}{3},\textcolor{red}{3}) of \cref{eq:prelinkmultip_right,eq:prelinkmultip_left} as corresponding equal, equation \ref{eq:equal_3-3} is formed.
\begin{equation} \label{eq:equal_3-3}
s_6 (s_1 n_x - c_1 n_y) + c_6 (s_1 o_x - c_1 o_y ) = c_4
\end{equation}

With $\theta_4$ and $\theta_1$ known, equation \ref{eq:equal_3-3} can be reformed into a solution for $\theta_6$ as seen in equation \ref{eq:sol_theta_6_appendix}.
\begin{equation}\label{eq:sol_theta_6_appendix}
\theta_{6_{1/2}} = \atantwo(s_1 n_x -c_1 n_y , s_1 o_x -c_1 o_y) \pm \atantwo(\sqrt{(s_1 n_x - c_1 n_y)^2 + (s_1 o_x - c_1 o_y )^2 - c_4^2} , c_4)
\end{equation}
\medskip
With \ref{eq:sol_theta_1},\ref{eq:sol_theta_2},\ref{eq:sol_theta_3},\ref{eq:sol_theta_4},\ref{eq:sol_theta_5} and \ref{eq:sol_theta_6} the values for $(\theta_1, \theta_2, \theta_3, \theta_4, \theta_5, \theta_6)$ can be calculated for all reachable end effector positions.\\

For details on the \gls{atan2} function, see the glossary.
\medskip